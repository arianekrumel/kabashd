
include SessionsHelper
include ApplicationHelper
include GamesHelper
class DescriptionParser


	def initialize()

		@@goal = nil
		@@keys = Hash.new

	end

	def goal_action
		return @@goal
	end

	def parseDescription(description)
		if(description.index("{") != nil)
			@@goal = description[0..description.index("{")-1]
			rules = description[description.index("{")+1..description.index("}")-1].split(" + ")
			if(description.index("keys(") != nil)
				temp = description[description.index("keys(")+1..description.index(")")-1].split(", ")
				for key in temp
					if @@keys[key] == nil
						@@keys[key] = false
					end
				end
			end
		else
			@@goal = description
		end
	end


	def parseAction(args)
		
		if @@goal == "Name"
			game = Games.find(args[0])
			game.player_name = args[1]
			return @@goal
		end
			
		action = query_watson(input, "Story")
		if @@keys[action] != nil
			if @@keys[action] == true
				return "Already Done"
			end
			@@keys[action] = true
		end
	
		goal = true
		for key, value in @@keys
			if(!value)
				goal = false
				return action
			end
		end

		return @@goal
	end


end
